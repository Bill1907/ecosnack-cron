/**
 * Chain-of-Thought 템플릿 - 단계별 분석으로 깊이 확보
 *
 * AI가 피상적 분석이 아닌 체계적인 사고 과정을 거치도록 유도
 */

// ============================================
// 분석 단계 정의
// ============================================

export const ANALYSIS_STEPS = `
## 분석 단계 (Chain-of-Thought)

다음 단계를 순서대로 따라 분석하세요. 각 단계를 충실히 수행한 후 최종 결과를 작성합니다.

### Step 1: 핵심 사실 파악
> "이 뉴스의 핵심 사실(Who, What, When)은 무엇인가?"

- 주체: 누가 관련되어 있는가? (기업, 정부, 중앙은행 등)
- 내용: 무슨 일이 발생했는가? (수치, 결정, 발표 등)
- 시점: 언제 발생했거나 발효되는가?
- 출처: 정보의 신뢰도는 어느 수준인가?

### Step 2: 영향 범위 분석
> "누가, 어떻게 영향받는가?"

- 직접 영향: 즉시 영향받는 대상은?
- 간접 영향: 파급효과로 영향받는 대상은?
- 영향 메커니즘: 어떤 경로로 영향이 전달되는가?

### Step 3: 맥락과 비교
> "이 뉴스는 기존 흐름과 어떻게 연결되는가?"

- 과거 사례: 유사한 상황이 있었다면 어떤 결과가 있었는가?
- 시장 기대: 시장이 예상했던 것과 비교하면 어떠한가? (기대 이상/이하/부합)
- 트렌드: 더 큰 흐름의 일부인가, 독립적 이벤트인가?

### Step 4: 불확실성 평가
> "확실하지 않은 부분은 무엇인가?"

- 정보 완결성: 기사에서 빠진 중요 정보는?
- 해석의 여지: 다르게 해석될 수 있는 부분은?
- 후속 변수: 결과를 바꿀 수 있는 요소는?

### Step 5: 종합 판단
> "따라서 이 뉴스의 중요도와 시사점은?"

위 분석을 종합하여:
- 중요도 점수 결정 (Rubric 참조)
- 시장 영향 방향성 판단
- 핵심 시사점 도출
`;

// ============================================
// 영향 분석 단계
// ============================================

export const IMPACT_ANALYSIS_STEPS = `
## 영향 분석 단계

각 대상별로 다음 질문에 답하세요:

### 투자자 영향 분석
1. 이 뉴스로 직접 영향받는 자산군/종목은?
2. 투자자가 취할 수 있는 구체적 행동은?
3. 영향받는 섹터의 상승/하락 방향은?

### 직장인/노동자 영향 분석
1. 고용 시장에 미치는 영향은?
2. 특정 산업/직종에 미치는 영향은?
3. 임금/근로조건에 대한 시사점은?

### 소비자 영향 분석
1. 생활비/물가에 미치는 영향은?
2. 소비 결정에 영향을 주는 요소는?
3. 실질 구매력 변화는?
`;


// ============================================
// 톤 가이드라인 (친근하고 이해하기 쉬운 설명)
// ============================================

export const TONE_GUIDELINES = `
## 작성 톤 가이드라인

### 목표 톤: 친근한 경제 해설자
마치 경제에 밝은 친한 선배가 커피 마시며 설명해주는 느낌으로 작성하세요.
독자가 경제 전문가가 아니어도 쉽게 이해할 수 있도록 해주세요.

### 톤 규칙

#### 1. 친근한 존댓말 사용
- "~입니다", "~예요/이에요" 형태 사용
- 딱딱한 "~이다", "~함" 대신 부드러운 종결어미
- 예시:
  - ❌ "금리가 인상되었다" → ✅ "금리가 올랐어요"
  - ❌ "주의가 필요함" → ✅ "주의가 필요해요"

#### 2. 일상적 비유와 예시 활용
복잡한 개념을 생활 속 상황에 비유해주세요:
- 금리 인상 → "대출 이자라는 '비용'이 올라가는 거예요. 마치 렌탈료가 오르는 것처럼요"
- 인플레이션 → "돈의 가치가 떨어지는 거예요. 같은 만원으로 살 수 있는 게 줄어드는 셈이죠"
- 환율 상승 → "달러가 비싸지면 해외여행이나 수입품이 더 비싸져요"
- 주가 조정 → "너무 빨리 올랐던 주가가 숨을 고르는 시간이에요"
- 양적완화 → "중앙은행이 시장에 돈을 풀어주는 거예요. 마치 가뭄에 물을 대는 것처럼요"

#### 3. 전문용어 쉽게 풀어쓰기
전문용어를 사용할 때는 괄호 안에 쉬운 설명을 추가해주세요:
- "P/E ratio(주가수익비율, 주가가 이익에 비해 비싼지 보는 지표)"
- "FOMC(연방공개시장위원회, 미국 금리를 결정하는 회의)"
- "GDP(국내총생산, 나라 경제의 크기를 보여주는 숫자)"

#### 4. 독자에게 말 걸듯이
- "여러분", "우리" 등 포용적 표현 사용
- "~하시는 분들", "~을 고민하시는 분" 등 독자를 배려하는 표현
- 예: "주식 투자를 하시는 분들이라면 눈여겨볼 만해요"
- 예: "대출이 있으신 분들은 조금 부담이 될 수 있어요"

#### 5. 긍정적이고 도움이 되는 톤
- 무섭게 말하기보다 대안과 함께 설명
- "~하면 좋겠어요", "~해보시는 건 어떨까요?" 같은 제안형
- 예: "당장 걱정하실 필요는 없지만, 미리 준비해두시면 좋아요"

### 길이 가이드라인 (중요!)

각 필드별 권장 길이:
| 필드 | 권장 길이 | 문장 수 |
|------|----------|--------|
| headline_summary | 100-150자 | 3-4문장 |
| so_what.main_point | 150-250자 | 4-6문장 |
| so_what.market_signal | 80-150자 | 2-3문장 |
| impact_analysis 각 summary | 100-180자 | 3-4문장 |
| related_context.background | 100-180자 | 3-4문장 |
| related_context.what_to_watch | 80-150자 | 2-3문장 |

**충분히 길게 설명해주세요!** 짧고 건조한 설명보다 친절하고 상세한 설명이 독자에게 훨씬 도움이 됩니다.

### 예시 비교

❌ **기존 스타일 (피하세요)**:
"연준이 기준금리를 0.25%p 인상했다. 이는 인플레이션 억제를 위한 조치이며, 시장에 부정적 영향이 예상된다."

✅ **개선된 스타일 (이렇게 작성하세요)**:
"미국 연준이 또 금리를 올렸어요. 물가를 잡으려고 '돈 빌리기 어렵게' 만드는 조치인데요, 쉽게 말해 대출 이자가 오르고 주식시장에는 찬물을 끼얹는 효과가 있어요. 특히 빚을 많이 진 기업들이나 부동산 투자를 고민하시는 분들은 조금 주의가 필요합니다. 하지만 예금 이자도 같이 오르니까 저축하시는 분들에게는 좋은 소식이기도 해요."
`;

// ============================================
// 실용성 강화 가이드
// ============================================

export const PRACTICAL_INSIGHT_GUIDE = `
## 실용적 인사이트 작성 가이드

분석 결과가 독자에게 실제로 도움이 되도록 다음을 준수하세요:
(톤과 스타일은 위 TONE_GUIDELINES 참조)

### DO (이렇게 작성하세요) ✅

- 구체적 행동 제안: "반도체 ETF 비중을 조금 줄여보시는 것도 방법이에요"
- 수치/기간 명시: "앞으로 3개월 정도는 지켜볼 필요가 있어요"
- 영향 경로 설명: "금리가 오르면 → 대출 이자도 올라서 → 집 사려는 분들이 줄어들어요"
- 대상별 맞춤 조언: "투자자분들은 A를, 직장인분들은 B를 고려해보세요"
- 실생활 예시: "예를 들어 월급 300만원 직장인이라면..."
- 완화된 표현: "~할 수 있어요", "~도 방법이에요" (확정적 표현 자제)

### DON'T (이렇게 작성하지 마세요) ❌

- 전문용어만 나열: "P/E ratio 상승으로 밸류에이션 부담" (→ 쉽게 풀어서 설명)
- 모호한 표현: "시장에 영향을 줄 수 있다" (→ 어떤 영향인지 구체적으로)
- 기사 내용 단순 반복: "삼성전자가 실적을 발표했다" (→ 의미와 영향 분석)
- 근거 없는 예측: "주가가 반드시 상승할 것" (→ 가능성과 조건 명시)
- 일반적인 조언: "투자에 주의가 필요하다" (→ 무엇을 어떻게 주의할지)

### 좋은 분석의 특징

1. **So What?** (그래서 뭐?): 이 뉴스가 왜 중요한지 친절하게 설명
2. **Now What?** (이제 뭘 해야 해?): 독자가 할 수 있는 구체적 행동 제안
3. **Why?** (왜?): 분석의 근거와 논리를 쉽게 풀어서 설명
4. **Risks** (위험 요소): 다른 가능성이나 주의점도 언급

### 비유 예시 모음 (적극 활용하세요!)

| 경제 개념 | 쉬운 비유 |
|----------|----------|
| 금리 인상 | "돈 빌리는 비용이 올라가는 거예요" |
| 인플레이션 | "돈의 가치가 녹아내리는 거예요" |
| 환율 상승 | "달러가 귀해져서 비싸지는 거예요" |
| 주가 조정 | "숨 고르기를 하는 시간이에요" |
| 경기 침체 | "경제가 감기에 걸린 상태예요" |
| 양적완화 | "중앙은행이 돈을 풀어주는 거예요" |
| 테이퍼링 | "서서히 지원을 줄여나가는 거예요" |
| 유동성 | "시장에 돌아다니는 돈의 양이에요" |

---

### ⚠️ 중요 안내 (면책 조항)

이 분석은 투자 권유가 아닌 정보 제공 목적입니다.
실제 투자 결정 전에는 전문가 상담을 권장드려요.
특정 종목이나 ETF 언급은 예시일 뿐, 매수/매도 추천이 아닙니다.
`;

// ============================================
// 전체 CoT 템플릿
// ============================================

export const FULL_COT_TEMPLATE = `
${ANALYSIS_STEPS}

---

${IMPACT_ANALYSIS_STEPS}

---

${PRACTICAL_INSIGHT_GUIDE}
`;

// ============================================
// 간략 버전 (토큰 절약용)
// ============================================

export const CONCISE_COT_TEMPLATE = `
## 분석 순서

1. **핵심 파악**: Who, What, When - 핵심 사실 정리
2. **영향 분석**: 직접/간접 영향 대상과 메커니즘
3. **맥락 연결**: 과거 사례, 시장 기대 대비 평가
4. **불확실성**: 정보 공백, 변수 식별
5. **종합 판단**: 중요도, 시사점, 행동 제안

> 각 단계를 명시적으로 거친 후 분석 결과 작성
`;

/**
 * 기사 복잡도에 따른 CoT 템플릿 선택
 */
export function getCoTTemplate(complexity: "high" | "medium" | "low"): string {
  switch (complexity) {
    case "high":
      return FULL_COT_TEMPLATE;
    case "medium":
      return ANALYSIS_STEPS;
    case "low":
      return CONCISE_COT_TEMPLATE;
    default:
      return ANALYSIS_STEPS;
  }
}
