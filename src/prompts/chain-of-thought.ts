/**
 * Chain-of-Thought 템플릿 - 단계별 분석으로 깊이 확보
 *
 * AI가 피상적 분석이 아닌 체계적인 사고 과정을 거치도록 유도
 */

// ============================================
// 분석 단계 정의
// ============================================

export const ANALYSIS_STEPS = `
## 분석 단계 (Chain-of-Thought)

다음 단계를 순서대로 따라 분석하세요. 각 단계를 충실히 수행한 후 최종 결과를 작성합니다.

### Step 1: 핵심 사실 파악
> "이 뉴스의 핵심 사실(Who, What, When)은 무엇인가?"

- 주체: 누가 관련되어 있는가? (기업, 정부, 중앙은행 등)
- 내용: 무슨 일이 발생했는가? (수치, 결정, 발표 등)
- 시점: 언제 발생했거나 발효되는가?
- 출처: 정보의 신뢰도는 어느 수준인가?

### Step 2: 영향 범위 분석
> "누가, 어떻게 영향받는가?"

- 직접 영향: 즉시 영향받는 대상은?
- 간접 영향: 파급효과로 영향받는 대상은?
- 영향 메커니즘: 어떤 경로로 영향이 전달되는가?

### Step 3: 맥락과 비교
> "이 뉴스는 기존 흐름과 어떻게 연결되는가?"

- 과거 사례: 유사한 상황이 있었다면 어떤 결과가 있었는가?
- 시장 기대: 시장이 예상했던 것과 비교하면 어떠한가? (기대 이상/이하/부합)
- 트렌드: 더 큰 흐름의 일부인가, 독립적 이벤트인가?

### Step 4: 불확실성 평가
> "확실하지 않은 부분은 무엇인가?"

- 정보 완결성: 기사에서 빠진 중요 정보는?
- 해석의 여지: 다르게 해석될 수 있는 부분은?
- 후속 변수: 결과를 바꿀 수 있는 요소는?

### Step 5: 종합 판단
> "따라서 이 뉴스의 중요도와 시사점은?"

위 분석을 종합하여:
- 중요도 점수 결정 (Rubric 참조)
- 시장 영향 방향성 판단
- 핵심 시사점 도출
`;

// ============================================
// 영향 분석 단계
// ============================================

export const IMPACT_ANALYSIS_STEPS = `
## 영향 분석 단계

각 대상별로 다음 질문에 답하세요:

### 투자자 영향 분석
1. 이 뉴스로 직접 영향받는 자산군/종목은?
2. 투자자가 취할 수 있는 구체적 행동은?
3. 영향받는 섹터의 상승/하락 방향은?

### 직장인/노동자 영향 분석
1. 고용 시장에 미치는 영향은?
2. 특정 산업/직종에 미치는 영향은?
3. 임금/근로조건에 대한 시사점은?

### 소비자 영향 분석
1. 생활비/물가에 미치는 영향은?
2. 소비 결정에 영향을 주는 요소는?
3. 실질 구매력 변화는?
`;

// ============================================
// 실용성 강화 가이드
// ============================================

export const PRACTICAL_INSIGHT_GUIDE = `
## 실용적 인사이트 작성 가이드

분석 결과가 독자에게 실제로 도움이 되도록 다음을 준수하세요:

### DO (이렇게 작성)
- ✅ 구체적 행동 제안: "반도체 ETF 비중 조정 검토"
- ✅ 수치/기간 명시: "3개월 내 금리 동결 가능성 60%"
- ✅ 영향 경로 설명: "금리 인상 → 대출 비용 증가 → 주택 수요 감소"
- ✅ 대상별 맞춤 조언: "투자자는 A, 소비자는 B 고려"

### DON'T (이렇게 작성하지 마세요)
- ❌ 모호한 표현: "시장에 영향을 줄 수 있다"
- ❌ 기사 내용 반복: "삼성전자가 실적을 발표했다"
- ❌ 근거 없는 예측: "주가가 반드시 상승할 것"
- ❌ 일반적인 조언: "투자에 주의가 필요하다"

### 좋은 분석의 특징
1. **So What?**: 이 뉴스가 왜 중요한지 명확히 설명
2. **Now What?**: 독자가 무엇을 해야 하는지 제안
3. **Why?**: 분석의 근거와 논리 제시
4. **Risks**: 다른 가능성/위험 요소 언급
`;

// ============================================
// 전체 CoT 템플릿
// ============================================

export const FULL_COT_TEMPLATE = `
${ANALYSIS_STEPS}

---

${IMPACT_ANALYSIS_STEPS}

---

${PRACTICAL_INSIGHT_GUIDE}
`;

// ============================================
// 간략 버전 (토큰 절약용)
// ============================================

export const CONCISE_COT_TEMPLATE = `
## 분석 순서

1. **핵심 파악**: Who, What, When - 핵심 사실 정리
2. **영향 분석**: 직접/간접 영향 대상과 메커니즘
3. **맥락 연결**: 과거 사례, 시장 기대 대비 평가
4. **불확실성**: 정보 공백, 변수 식별
5. **종합 판단**: 중요도, 시사점, 행동 제안

> 각 단계를 명시적으로 거친 후 분석 결과 작성
`;

/**
 * 기사 복잡도에 따른 CoT 템플릿 선택
 */
export function getCoTTemplate(complexity: "high" | "medium" | "low"): string {
  switch (complexity) {
    case "high":
      return FULL_COT_TEMPLATE;
    case "medium":
      return ANALYSIS_STEPS;
    case "low":
      return CONCISE_COT_TEMPLATE;
    default:
      return ANALYSIS_STEPS;
  }
}
